name: Project Summary

on:
  push:
    branches: [main]
  pull_request:
    branches: [main]

jobs:
  summary:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v3

    - name: Setup Flutter
      uses: subosito/flutter-action@v2
      with:
        flutter-version: '3.19.6'
        channel: 'stable'

    - name: Install dependencies
      run: flutter pub get

    - name: Project Statistics
      run: |
        echo "๐ฏ ===== ุชุญููู ูุดุฑูุน Auto Shop ====="
        echo ""
        echo "๐ฆ ุฅุญุตุงุฆูุงุช ุงููููุงุช:"
        echo "- ุนุฏุฏ ูููุงุช Dart: $(find lib -name "*.dart" | wc -l)"
        echo "- ุนุฏุฏ ูููุงุช ุงูุชุณุช: $(find test -name "*.dart" 2>/dev/null | wc -l || echo 0)"
        echo "- ุนุฏุฏ ูููุงุช Integration Test: $(find integration_test -name "*.dart" 2>/dev/null | wc -l || echo 0)"
        echo ""
        echo "๐ ุฅุญุตุงุฆูุงุช ุงูุฃุณุทุฑ:"
        TOTAL_LINES=$(find lib -name "*.dart" -exec cat {} \; | wc -l)
        echo "- ุนุฏุฏ ุฃุณุทุฑ ุงูููุฏ: $TOTAL_LINES"
        echo ""
        echo "๐งฉ ุชุญููู ุงูููุฏุฌุช:"
        STATELESS_COUNT=$(grep -r "extends StatelessWidget" lib --include="*.dart" | wc -l)
        STATEFUL_COUNT=$(grep -r "extends StatefulWidget" lib --include="*.dart" | wc -l)
        CONSUMER_COUNT=$(grep -r "extends Consumer" lib --include="*.dart" | wc -l)
        echo "- StatelessWidget: $STATELESS_COUNT"
        echo "- StatefulWidget: $STATEFUL_COUNT"
        echo "- ConsumerWidget: $CONSUMER_COUNT"
        echo ""
        echo "๐ฑ ุตูุญุงุช ุงูุชุทุจูู:"
        PAGE_COUNT=$(find lib/pages -name "*.dart" 2>/dev/null | wc -l || echo 0)
        echo "- ุนุฏุฏ ุงูุตูุญุงุช: $PAGE_COUNT"
        echo ""
        echo "๐ง ุงูููููุงุช:"
        PROVIDER_COUNT=$(find lib/providers -name "*.dart" 2>/dev/null | wc -l || echo 0)
        MODEL_COUNT=$(find lib/models -name "*.dart" 2>/dev/null | wc -l || echo 0)
        SERVICE_COUNT=$(find lib/services -name "*.dart" 2>/dev/null | wc -l || echo 0)
        echo "- Providers: $PROVIDER_COUNT"
        echo "- Models: $MODEL_COUNT"
        echo "- Services: $SERVICE_COUNT"

    - name: Analyze code quality
      run: |
        echo ""
        echo "๐ ===== ุชุญููู ุฌูุฏุฉ ุงูููุฏ ====="
        flutter analyze --no-fatal-infos > analysis_output.txt 2>&1 || true
        if grep -q "No issues found!" analysis_output.txt; then
          echo "โ ุงูููุฏ ุฎุงูู ูู ุงููุดุงูู!"
        else
          echo "โ๏ธ ุชู ุงูุนุซูุฑ ุนูู ูุดุงูู:"
          cat analysis_output.txt
        fi

    - name: Check formatting
      run: |
        echo ""
        echo "๐จ ===== ูุญุต ุงูุชูุณูู ====="
        if flutter format --dry-run --set-exit-if-changed lib/; then
          echo "โ ุงูููุฏ ููุณู ุจุดูู ุตุญูุญ"
        else
          echo "โ๏ธ ูุญุชุงุฌ ุงูููุฏ ุฅูู ุชูุณูู"
        fi

    - name: Run tests
      run: |
        echo ""
        echo "๐งช ===== ุชุดุบูู ุงูุงุฎุชุจุงุฑุงุช ====="
        if flutter test --coverage; then
          echo "โ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ูุฌุญุช!"
        else
          echo "โ ุจุนุถ ุงูุงุฎุชุจุงุฑุงุช ูุดูุช"
        fi

    - name: Build check
      run: |
        echo ""
        echo "๐๏ธ ===== ูุญุต ุงูุจูุงุก ====="
        if flutter build apk --debug; then
          echo "โ ุงูุจูุงุก ูุฌุญ!"
        else
          echo "โ ุงูุจูุงุก ูุดู"
        fi

    - name: Dependencies check
      run: |
        echo ""
        echo "๐ฆ ===== ูุญุต ุงูุชุจุนูุงุช ====="
        flutter pub deps --style=compact
        echo ""
        echo "๐ ูุญุต ุงูุฃูุงู:"
        flutter pub audit || echo "โ๏ธ ุชุญุฐูุฑ: ูุฏ ุชูุฌุฏ ูุดุงูู ุฃูููุฉ"

    - name: Project summary
      run: |
        echo ""
        echo "๐ ===== ููุฎุต ุงููุดุฑูุน ====="
        echo "๐ฏ ูุดุฑูุน: Auto Shop - ุชุทุจูู ูุทุน ุบูุงุฑ ุงูุณูุงุฑุงุช"
        echo "๐ ุชุงุฑูุฎ ุงูุชุญููู: $(date)"
        echo "๐ง ุฅุตุฏุงุฑ Flutter: $(flutter --version | head -n 1)"
        echo ""
        echo "โ ุชู ุชุญููู ุงููุดุฑูุน ุจูุฌุงุญ!"
        echo "๐ ุงููุดุฑูุน ุฌุงูุฒ ูููุดุฑ!"
